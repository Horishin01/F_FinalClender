@{
    ViewData["Title"] = "Áµ±Âêà„Ç´„É¨„É≥„ÉÄ„ÉºÁÆ°ÁêÜ";
    ViewData["BodyClass"] = "events-page";
    var isAdmin = User.IsInRole(TimeLedger.Models.RoleNames.Admin);
}

@if (TempData["StatusMessage"] is string status && !string.IsNullOrWhiteSpace(status))
{
    <div class="alert alert-warning" role="alert" style="margin:12px 0;">
        <strong>ÈÄ£Êê∫„É°„ÉÉ„Çª„Éº„Ç∏:</strong> @status
    </div>
}

<div class="ic-root">
    <div class="ic-header">
        <div class="ic-brand">
            <span class="ic-logo">üìÖ</span>
            <div>
                <div class="ic-eyebrow">Áµ±Âêà„Ç´„É¨„É≥„ÉÄ„ÉºÁÆ°ÁêÜ</div>
                <div class="ic-title">„Ç§„Éô„É≥„Éà„Ç´„É¨„É≥„ÉÄ„Éº</div>
            </div>
        </div>
    </div>

    <div class="mobile-quick-actions" aria-label="„É¢„Éê„Ç§„É´Áî®„ÅÆ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà">
        <button type="button" class="ic-btn primary mini" data-action="create-event">
            <i class="fa-solid fa-plus"></i> ËøΩÂä†
        </button>
        <button type="button" class="ic-btn ghost mini" data-action="scroll-calendar">
            <i class="fa-solid fa-calendar-day"></i> „Ç´„É¨„É≥„ÉÄ„Éº„Å∏
        </button>
        <button type="button" class="ic-btn primary mini" data-action="toggle-filters">
            <i class="fa-solid fa-sliders"></i> „Éï„Ç£„É´„Çø„ÉºË°®Á§∫
        </button>
        <button type="button" class="ic-btn ghost mini" data-action="toggle-insights">
            <i class="fa-solid fa-chart-column"></i> Áµ±Ë®à/‰∫àÂÆö
        </button>
    </div>

    <div class="ic-layout">
        <div class="ic-sidebar-left mobile-collapsible" id="icSidebarLeft">
            <div class="mobile-sheet-head">
                <div>
                    <p class="eyebrow">„Éï„Ç£„É´„Çø„Éº</p>
                    <strong>Ë°®Á§∫„ÇíÁµû„ÇäËæº„Åø</strong>
                </div>
                <button type="button" class="ic-btn ghost mini" data-mobile-close="filters">
                    <i class="fa-solid fa-xmark"></i> Èñâ„Åò„Çã
                </button>
            </div>
            <div class="ic-card">
                <div class="ic-card-head">„Ç´„É¨„É≥„ÉÄ„Éº„ÇΩ„Éº„Çπ</div>
                <div class="ic-card-body ic-list" id="icSourceList">
                    <button class="ic-list-item active" data-source="all">
                        <span class="ic-list-label">
                            <span class="ic-list-icon icon-all">üìÖ</span>
                            <span>„Åô„Åπ„Å¶Ë°®Á§∫</span>
                        </span>
                        <span class="count" id="srcAll">0</span>
                    </button>
                    <button class="ic-list-item" data-source="Google">
                        <span class="ic-list-label">
                            <span class="ic-list-icon icon-google">G</span>
                            <span>Google Calendar</span>
                        </span>
                        <span class="count" id="srcGoogle">0</span>
                    </button>
                    @if (isAdmin)
                    {
                        <button class="ic-list-item" data-source="ICloud">
                            <span class="ic-list-label">
                                <span class="ic-list-icon icon-icloud">‚òÅÔ∏è</span>
                                <span>iCloud Calendar</span>
                            </span>
                            <span class="count" id="srcICloud">0</span>
                        </button>
                    }
                    <button class="ic-list-item" data-source="Outlook">
                        <span class="ic-list-label">
                            <span class="ic-list-icon icon-outlook">üìß</span>
                            <span>Outlook Calendar</span>
                        </span>
                        <span class="count" id="srcOutlook">0</span>
                    </button>
                    <button class="ic-list-item" data-source="Work">
                        <span class="ic-list-label">
                            <span class="ic-list-icon icon-work">üíº</span>
                            <span>‰ºöÁ§æ„Ç´„É¨„É≥„ÉÄ„Éº</span>
                        </span>
                        <span class="count" id="srcWork">0</span>
                    </button>
                    <button class="ic-list-item" data-source="Local">
                        <span class="ic-list-label">
                            <span class="ic-list-icon icon-local">üíæ</span>
                            <span>„É≠„Éº„Ç´„É´</span>
                        </span>
                        <span class="count" id="srcLocal">0</span>
                    </button>
                </div>
            </div>

            <div class="ic-card">
                <div class="ic-card-head">
                    <span>„Ç´„ÉÜ„Ç¥„É™„Éï„Ç£„É´„Çø„Éº</span>
                    <div class="ic-head-actions">
                        <a class="ic-btn ghost mini" asp-controller="Categories" asp-action="Index">
                            <i class="fa-solid fa-plus"></i> „Ç´„ÉÜ„Ç¥„É™ÁÆ°ÁêÜ
                        </a>
                    </div>
                </div>
                <div class="ic-card-body ic-list" id="icCategoryList"></div>
            </div>
        </div>

        <div class="ic-main" id="icMain">
            <div class="ic-main-head">
                <div class="ic-month-nav">
                    <button id="calPrev" class="ic-nav-btn">‚óÄ</button>
                    <div id="calPeriod" class="ic-month-label">----</div>
                    <button id="calNext" class="ic-nav-btn">‚ñ∂</button>
                </div>
                <div class="ic-views">
                    <button id="viewMonth" class="view-btn active">Êúà</button>
                    <button id="viewWeek" class="view-btn">ÈÄ±</button>
                    <button id="viewDay" class="view-btn">Êó•</button>
                </div>
                <div class="ic-main-actions">
                    <a id="createBtn" class="ic-btn primary" asp-controller="Events" asp-action="Create">
                        <i class="fa-solid fa-plus"></i> Êñ∞Ë¶èËøΩÂä†
                    </a>
                    <button id="calToday" class="ic-btn ghost"><i class="fa-solid fa-calendar-day"></i> ‰ªäÊó•</button>
                    <form id="syncForm" method="post">
                        @Html.AntiForgeryToken()
                        <button type="button" class="ic-btn sync" id="syncBtn"><i class="fa-solid fa-arrows-rotate"></i> „Åô„Åπ„Å¶ÂêåÊúü</button>
                    </form>
                    <form asp-controller="ExternalCalendars" asp-action="Sync" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="provider" value="Outlook" />
                        <button type="submit" class="ic-btn ghost" data-sync-provider="Outlook"><i class="fa-brands fa-microsoft"></i> OutlookÂêåÊúü</button>
                    </form>
                    <form asp-controller="ExternalCalendars" asp-action="Sync" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="provider" value="Google" />
                        <button type="submit" class="ic-btn ghost" data-sync-provider="Google"><i class="fa-brands fa-google"></i> GoogleÂêåÊúü</button>
                    </form>
                </div>
            </div>
            <div class="ic-calendar-wrap">
                <div id="calendar"></div>
            </div>
        </div>

        <div class="ic-sidebar-right mobile-collapsible" id="icSidebarRight">
            <div class="mobile-sheet-head">
                <div>
                    <p class="eyebrow">„Ç§„É≥„Çµ„Ç§„Éà</p>
                    <strong>Ê§úÁ¥¢„ÉªÁµ±Ë®à„ÉªÁõ¥Ëøë‰∫àÂÆö</strong>
                </div>
                <button type="button" class="ic-btn ghost mini" data-mobile-close="insights">
                    <i class="fa-solid fa-xmark"></i> Èñâ„Åò„Çã
                </button>
            </div>
            <div class="ic-card">
                <div class="ic-card-head">
                    <span class="ic-card-title">
                        <span class="ic-card-title-icon icon-search">üîç</span>
                        <span>Ê§úÁ¥¢</span>
                    </span>
                </div>
                <div class="ic-card-body">
                    <input id="icSearch" type="search" class="ic-input" placeholder="„Ç§„Éô„É≥„Éà„ÇíÊ§úÁ¥¢..." />
                </div>
            </div>

            <div class="ic-card">
                <div class="ic-card-head">
                    <span class="ic-card-title">
                        <span class="ic-card-title-icon icon-stats">üìä</span>
                        <span>Áµ±Ë®àÊÉÖÂ†±</span>
                    </span>
                </div>
                <div class="ic-card-body ic-stats" id="icStats">
                    <button type="button" class="ic-stat" data-stat="today">
                        <div class="ic-stat-text">
                            <div class="label">‰ªäÊó•</div>
                            <div class="value" id="statToday">0</div>
                        </div>
                        <span class="ic-stat-icon icon-today">üìÜ</span>
                    </button>
                    <button type="button" class="ic-stat" data-stat="week">
                        <div class="ic-stat-text">
                            <div class="label">‰ªäÈÄ±</div>
                            <div class="value" id="statWeek">0</div>
                        </div>
                        <span class="ic-stat-icon icon-week">üóìÔ∏è</span>
                    </button>
                    <button type="button" class="ic-stat" data-stat="dup">
                        <div class="ic-stat-text">
                            <div class="label">ÈáçË§áÊé®ÂÆö</div>
                            <div class="value" id="statDup">0</div>
                        </div>
                        <span class="ic-stat-icon icon-conflict">‚ö†Ô∏è</span>
                    </button>
                </div>
            </div>

            <div class="ic-card">
                <div class="ic-card-head">
                    <span class="ic-card-title">
                        <span class="ic-card-title-icon icon-upcoming">üóìÔ∏è</span>
                        <span>Áõ¥Ëøë„ÅÆ‰∫àÂÆö</span>
                    </span>
                </div>
                <div class="ic-card-body">
                    <ul class="ic-upcoming" id="icUpcoming"></ul>
                </div>
            </div>
        </div>
    </div>

    <div class="mobile-overlay" id="mobileOverlay" aria-hidden="true"></div>

</div>

@section Styles {
    <link rel="stylesheet" href="~/lib/fullcalendar/main.min.css" />
    <link rel="stylesheet" href="~/css/calendar-ui.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/events-integrated.css" asp-append-version="true" />
}

@section Scripts {
    <script src="~/lib/fullcalendar/index.global.min.js"></script>
    <script src="~/js/locales-all.min.js"></script>
    <script src="~/js/events-integrated.js" asp-append-version="true"></script>
}
