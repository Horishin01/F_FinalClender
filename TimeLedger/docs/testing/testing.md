# テスト方針（更新日: 2026-02-13）

## 現状
- 自動テストプロジェクトは未整備。
- 出荷前は手動回帰テストを実施し、最低限の認可テストを必須化する。

## アプリ別手動チェックリスト
- `Home / Privacy / Flow`
- 匿名アクセスで表示可能な内容のみ表示されること。
- Flow の記録がブラウザローカル保存で完結し、サーバー保存されないこと。

- `Events（カレンダー）`
- ログインユーザーのイベントのみ表示・編集・削除できること。
- 他ユーザーのイベント ID を指定しても参照/更新/削除できないこと。
- `Sync` が 60 秒レート制限とエラーハンドリングを維持していること。

- `Categories`
- CRUD が自ユーザー範囲で完結すること。
- 他ユーザーカテゴリ ID 指定で更新/削除できないこと。
- 使用中カテゴリ削除が拒否されること。

- `外部連携（Outlook/Google/iCloud）`
- 連携開始、再連携、解除、期限切れ時の再認証誘導が成立すること。
- 未連携状態で同期実行時に適切な案内画面へ遷移すること。
- iCloud 設定保存・更新・削除が管理者のみ実行可能であること。

- `ICカード`
- 管理者のみ登録/削除できること。
- 一般ユーザーは閲覧のみで操作不可であること。
- `pcsc-lite` 未導入時に案内メッセージが表示されること。

- `管理アプリ（Admin/Analytics/AppNotices/Users/Roles/UserRoles/Tools）`
- 匿名/一般ユーザーはアクセス拒否されること。
- 管理者は必要機能にアクセスできること。
- ユーザー管理・ロール管理の変更が期待通り反映されること。

## セキュリティ重点テスト
- 認可マトリクス試験（匿名/一般/管理者）を主要 URL に対して実施。
- CSRF トークンなし POST が拒否されること。
- 入力異常時に 500 を返さず、機密情報を画面表示しないこと。
- ログにトークン/パスワードが出力されないこと。

## 自動化の優先順
1. 認可・所有者照合の統合テスト（`WebApplicationFactory`）。
2. サービス層のユニットテスト（`ExternalCalendarSyncService`, `OutlookCalendarService`, `GoogleCalendarService`, `CloudCalDavService`）。
3. DB 統合テスト（Testcontainers PostgreSQL）。

## 実行コマンド（テスト追加後）
- `dotnet test`
