@model Pit2Hi022052.ViewModels.PrivacyViewModel
@{
    ViewData["Title"] = "プライバシーポリシー (アルファ版)";
    ViewData["BodyClass"] = "policy-page";
}

<section class="policy-shell">
    <div class="policy-hero">
        <p class="policy-eyebrow">Alpha Privacy</p>
        <h1>@ViewData["Title"]</h1>
        <p class="policy-lead">
            本サービスは統合カレンダーのアルファテスト環境として提供されています。以下のポリシーは、α版テスト参加者から取得する情報の取り扱いについて説明するものです。
        </p>
        <div class="policy-meta">
            <span class="policy-badge solid">テスト専用環境</span>
            <span class="policy-badge">暗号化ストレージ</span>
            <span class="policy-updated">最終更新日: @DateTime.UtcNow.ToString("yyyy-MM-dd")</span>
        </div>
    </div>

    <div class="policy-grid">
        <article class="policy-card">
            <div class="policy-card-head">
                <span class="policy-chip">収集</span>
                <span class="policy-label">What we collect</span>
            </div>
            <h2>取得する情報</h2>
            <ul class="policy-list">
                <li>サインインに必要なアカウント識別子（メールアドレス/ユーザーID）</li>
                <li>カレンダーイベントの内容（タイトル、日時、場所、メモ、カテゴリ等）</li>
                <li>同期テストに伴うメタデータ（成功/失敗ログ、タイムスタンプ）</li>
            </ul>
        </article>

        <article class="policy-card">
            <div class="policy-card-head">
                <span class="policy-chip accent">目的</span>
                <span class="policy-label">Why we use it</span>
            </div>
            <h2>利用目的</h2>
            <ul class="policy-list">
                <li>統合カレンダー機能の検証および品質向上</li>
                <li>障害解析やチューニングのための統計的な分析</li>
                <li>テスト参加者へのフィードバックや連絡</li>
            </ul>
        </article>

        <article class="policy-card">
            <div class="policy-card-head">
                <span class="policy-chip calm">共有</span>
                <span class="policy-label">Sharing policy</span>
            </div>
            <h2>第三者提供</h2>
            <p>
                法令に基づく場合を除き、第三者へ提供することはありません。外部サービス（iCloud など）への接続はユーザー本人の認証を前提としており、当社が外部資格情報を保管することはありません。
            </p>
        </article>
    </div>

    <div class="policy-timeline" aria-label="保管期間と削除の流れ">
        <div class="policy-step">
            <span class="step-badge">保存</span>
            <h3>テスト期間中のみ保存</h3>
            <p>取得したデータは暗号化ストレージに保管し、テストが継続する期間に限定して扱います。</p>
        </div>
        <div class="policy-step">
            <span class="step-badge warn">削除</span>
            <h3>終了後 60 日以内に削除</h3>
            <p>テスト終了後 60 日以内にデータを完全削除します。再開発用に要約された匿名統計データのみ保持する場合があります。</p>
        </div>
    </div>

    <div class="policy-contact">
        <div>
            <p class="policy-eyebrow">お問い合わせ</p>
            <h3>データの開示・訂正・削除・利用停止</h3>
            <p>アルファ版招待メールに記載の連絡先、または下記メールアドレスまでご連絡ください。</p>
            <a class="policy-contact-link" href="mailto:alpha-support@example.com">alpha-support@example.com</a>
        </div>
        <div class="policy-actions">
            <a class="policy-btn" href="mailto:alpha-support@example.com">メールで問い合わせる</a>
            <a class="policy-btn ghost" asp-controller="Home" asp-action="Index">ホームへ戻る</a>
        </div>
    </div>

    <div class="policy-updates" aria-label="アップデート履歴">
        <div class="policy-updates-head">
            <div>
                <p class="policy-eyebrow">Release Notes</p>
                <h3>アップデート履歴</h3>
                <p class="policy-lead small">バージョンごとの変更点を残しています。最新だけでなく過去の変更も追えるようにしています。</p>
            </div>
            <span class="policy-badge">現在のステータス: 正常稼働</span>
        </div>
        <div class="history-list">
            @if (Model?.Updates?.Any() == true)
            {
                foreach (var update in Model.Updates)
                {
                    var lines = (update.Highlights ?? string.Empty)
                        .Split(new[] { "\r\n", "\n" }, System.StringSplitOptions.RemoveEmptyEntries);
                    <article class="history-item">
                        <div class="update-meta">
                            <span class="version-badge">@(!string.IsNullOrWhiteSpace(update.Version) ? update.Version : "v---")</span>
                            <span class="update-date">@update.OccurredAt.ToString("yyyy-MM-dd")</span>
                        </div>
                        <h4>@update.Title</h4>
                        @if (!string.IsNullOrWhiteSpace(update.Description))
                        {
                            <p>@update.Description</p>
                        }
                        @if (lines.Length > 0)
                        {
                            <ul class="update-list">
                                @foreach (var line in lines)
                                {
                                    <li>@line</li>
                                }
                            </ul>
                        }
                    </article>
                }
            }
            else
            {
                <div class="empty-note">まだアップデートが登録されていません。</div>
            }
        </div>
    </div>

    <div class="policy-incidents" aria-label="障害情報">
        <div class="policy-updates-head">
            <div>
                <p class="policy-eyebrow">Incidents</p>
                <h3>障害情報</h3>
                <p class="policy-lead small">発生・復旧時刻と影響範囲をまとめています。障害は一覧で確認できるよう縦に並べています。</p>
            </div>
        </div>
        <div class="incident-list">
            @if (Model?.Incidents?.Any() == true)
            {
                foreach (var incident in Model.Incidents)
                {
                    var lines = (incident.Highlights ?? string.Empty)
                        .Split(new[] { "\r\n", "\n" }, System.StringSplitOptions.RemoveEmptyEntries);
                    <article class="incident-card">
                        <div class="update-meta">
                            <span class="pill warn">@(!string.IsNullOrWhiteSpace(incident.Status) ? incident.Status : "対応中")</span>
                            <span class="update-date">@incident.OccurredAt.ToString("yyyy-MM-dd")</span>
                        </div>
                        <h4>@incident.Title</h4>
                        @if (!string.IsNullOrWhiteSpace(incident.Description))
                        {
                            <p>@incident.Description</p>
                        }
                        <ul class="update-list">
                            @if (lines.Length > 0)
                            {
                                foreach (var line in lines)
                                {
                                    <li>@line</li>
                                }
                            }
                            else
                            {
                                <li>詳細未入力</li>
                            }
                            @if (incident.ResolvedAt.HasValue)
                            {
                                <li>復旧: @incident.ResolvedAt.Value.ToString("yyyy-MM-dd HH:mm")</li>
                            }
                        </ul>
                    </article>
                }
            }
            else
            {
                <div class="empty-note">障害情報は登録されていません。</div>
            }
        </div>
    </div>
</section>
